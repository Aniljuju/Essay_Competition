{% extends 'base.html' %}

{% block title %}Write Essay - {{ competition.title }}{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-lg-12">

            <!-- DOCUMENT PAGE -->
            <div class="document-page">

                <!-- Document Header -->
                <div class="document-meta">
                    <h2>{{ competition.title }}</h2>
                    <p>
                        {{ user.get_full_name }}<br>
                        {{ competition.end_date|date:"F d, Y" }}
                    </p>
                    <hr>
                </div>

                <!-- Progress Info -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <span class="badge badge-info">
                        Paragraph {{ current_count }} / {{ competition.max_paragraphs }}
                    </span>
                    <small class="text-muted">
                        {{ remaining }} paragraph{% if remaining != 1 %}s{% endif %} remaining
                    </small>
                </div>

                <!-- Existing Paragraphs -->
                {% if paragraphs %}
                {% for paragraph in paragraphs %}
                <div class="essay-paragraph">
                    {{ paragraph.content|linebreaks }}
                </div>
                {% endfor %}
                {% endif %}

                <!-- Warning -->
                <div class="alert alert-warning my-4">
                    <strong>⚠️ Important:</strong>
                    Once submitted, this paragraph cannot be edited or deleted.
                </div>

                <!-- Write Paragraph -->
                <form method="post" action="{% url 'essay_write' competition.id %}">
                    {% csrf_token %}

                    <div class="mb-4">
                        {{ form.content.label_tag }}
                        {{ form.content }}
                        {% if form.content.errors %}
                        <div class="text-danger small mt-1">
                            {{ form.content.errors }}
                        </div>
                        {% endif %}
                        <small class="text-muted">
                            Minimum 50 characters. Write carefully.
                        </small>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                            Back
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg">
                            {% if current_count|add:1 >= competition.max_paragraphs %}
                            Submit Final Paragraph
                            {% else %}
                            Submit Paragraph {{ current_count|add:1 }}
                            {% endif %}
                        </button>
                    </div>
                </form>

            </div>
            <!-- END DOCUMENT PAGE -->

        </div>
    </div>
</div>
{% endblock %}